{% if rows %}
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem; gap:1rem">
    <span style="font-size:0.75rem; color:var(--text-muted)">
        Showing <strong>{{ pathway_analyte_count }}</strong> pathway {{ analyte_label | lower }}{{ 's' if pathway_analyte_count != 1 }}
        &nbsp;·&nbsp; {{ total_row_count }} total rows in stats result
    </span>
    <button onclick="this.parentElement.parentElement.innerHTML=''; return false;"
            style="flex-shrink:0; padding:0.15rem 0.5rem; font-size:0.75rem; cursor:pointer; border:1px solid var(--border); border-radius:3px; background:var(--bg-alt); color:var(--text-muted)">
        ✕ Close
    </button>
</div>
<table style="font-size:0.8rem; border-collapse:collapse; min-width:100%">
    <thead>
        {# Top header row: one cell per comparison spanning its columns #}
        <tr>
            <th rowspan="2" style="position:sticky; left:0; z-index:2; text-align:left; padding:0.3rem 0.75rem;
                                   border-bottom:2px solid var(--border); white-space:nowrap;
                                   background:var(--bg-alt); box-shadow:2px 0 4px rgba(0,0,0,0.08)">{{ analyte_label }}</th>
            {% for comp in comparisons %}
            <th colspan="{{ comp.columns | length }}"
                style="text-align:center; padding:0.3rem 0.75rem; border-bottom:1px solid var(--border);
                       border-left:2px solid var(--border); white-space:nowrap; background:var(--bg-alt)">
                {% if comp.group1 and comp.group2 %}
                    {{ comp.group1 }} vs {{ comp.group2 }}
                {% else %}
                    {{ comp.comparison or "—" }}
                {% endif %}
            </th>
            {% endfor %}
        </tr>
        {# Second header row: one cell per stat column #}
        <tr>
            {% for comp in comparisons %}
            {% for col in comp.columns %}
            <th style="text-align:right; padding:0.3rem 0.75rem; border-bottom:2px solid var(--border);
                       border-left:{{ '2px solid var(--border)' if loop.first else '1px solid var(--border)' }};
                       white-space:nowrap; font-family:monospace; font-size:0.72rem; font-weight:normal;
                       background:var(--bg-alt)"
                {% if col.notes %}title="{{ col.notes }}"{% endif %}>
                {{ col.stat_type or col.column_name }}
            </th>
            {% endfor %}
            {% endfor %}
        </tr>
    </thead>
    <tbody>
    {% for met_id, met_name, vals in rows %}
    <tr>
        <td style="position:sticky; left:0; z-index:1; padding:0.3rem 0.75rem; border-bottom:1px solid var(--border);
                   white-space:nowrap; background:var(--bg-alt); box-shadow:2px 0 4px rgba(0,0,0,0.08)">
            <a href="{{ request.scope.get('root_path', '') }}{{ analyte_url_prefix }}{{ met_id | urlencode }}" style="font-size:0.8rem">{{ met_name }}</a>
            <div class="mono" style="font-size:0.7rem; color:var(--text-muted)">{{ met_id }}</div>
        </td>
        {% for col_name in col_order %}
        <td class="mono" style="text-align:right; padding:0.3rem 0.75rem; border-bottom:1px solid var(--border); white-space:nowrap; font-size:0.75rem">
            {% if vals.get(col_name) is not none %}{{ vals[col_name] }}{% else %}<span style="color:var(--text-muted)">—</span>{% endif %}
        </td>
        {% endfor %}
    </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<div style="display:flex; justify-content:space-between; align-items:center">
    <p style="color:var(--text-muted); font-size:0.875rem; margin:0">No statistical results found for pathway {{ analyte_label | lower }}s in this result set.</p>
    <button onclick="this.parentElement.parentElement.innerHTML=''; return false;"
            style="flex-shrink:0; padding:0.15rem 0.5rem; font-size:0.75rem; cursor:pointer; border:1px solid var(--border); border-radius:3px; background:var(--bg-alt); color:var(--text-muted)">
        ✕ Close
    </button>
</div>
{% endif %}
